import{r as S,o as u,c as k,u as x,a as D,b as g,d as $,e as h,w as B,v as L,f as p,F as M,g as T,h as N,L as m,p as H,i as O,t as R,j as z,k as I,l as v,m as K,n as j}from"./vendor.1474e9b6.js";const F=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}};F();var b=(e,a)=>{for(const[s,t]of a)e[s]=t;return e};const V={};function E(e,a,s,t,o,n){const i=S("router-view");return u(),k(i)}var G=b(V,[["render",E]]);const U={setup(){const e=x(),a=D(()=>e.state.currentPosition);let s=null;const t=()=>{const{latitude:c,longitude:r}=a.value;s=m.map("map").setView([c,r],15),m.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(s)},o=async c=>{const r=await Promise.all([e.dispatch("getStationData",c),e.dispatch("getAvailableData",c)]);return r[0].map(l=>{const{AvailableRentBikes:w,AvailableReturnBikes:P}=r[1].find(A=>A.stationUID===l.stationUID);return{stationPosition:l.StationPosition,stationName:l.StationName.Zh_tw,stationAddr:l.StationAddress.Zh_tw,availableRentBikes:w,availableReturnBikes:P}})},n=c=>{for(const r of c){const{PositionLat:d,PositionLon:l}=r.stationPosition;m.marker([d,l]).addTo(s).bindPopup(`
                    <h5 class="text-xl font-bold">${r.stationName}</h5>
                    <h4 class="my-2 text-base">${r.stationAddr}</h4>
                    <p class="!my-0 text-base">\u53EF\u501F\u8ECA\u8F1B\uFF1A${r.availableRentBikes}</p>
                    <p class="!my-0 text-base">\u53EF\u505C\u7A7A\u4F4D\uFF1A${r.availableReturnBikes}</p>
                `)}},i=g([]),y=g(""),C=async()=>{s.eachLayer(l=>{l instanceof m.Marker&&s.removeLayer(l)});const c=await o(y.value);n(c);const{PositionLat:r,PositionLon:d}=c[0].stationPosition;s.flyTo([r,d],11)};return $(async()=>{try{await e.dispatch("getCurrentPosition")}catch{console.log("\u7121\u6CD5\u5B9A\u4F4D\uFF0C\u5730\u5716\u521D\u59CB\u4F4D\u7F6E\u70BA\u884C\u5929\u5BAE")}t();const c=await Promise.all([e.dispatch("getCities"),o()]);i.value=c[0].filter(r=>["Taichung","Hsinchu","MiaoliCounty","NewTaipei","PingtungCounty","KinmenCounty","Taoyuan","Taipei","Kaohsiung","Tainan","Chiayi"].includes(r.City)),n(c[1])}),{showCities:i,selectedCity:y,search:C}}},f=e=>(H("data-v-62e00ac2"),e=e(),O(),e),X={id:"app"},q=f(()=>p("div",{id:"map",class:"z-10"},null,-1)),W={key:0,class:"fixed z-20 p-5 w-52 bg-white rounded-lg shadow-md top-[10px] left-14"},Z=f(()=>p("p",{class:"text-2xl font-bold leading-none"}," \u7AD9\u724C\u641C\u5C0B ",-1)),Q=f(()=>p("option",{value:""}," \u9078\u64C7\u7E23\u5E02 ",-1)),J=["value"],Y=["disabled"];function tt(e,a,s,t,o,n){return u(),h("div",X,[q,t.showCities.length?(u(),h("div",W,[Z,B(p("select",{"onUpdate:modelValue":a[0]||(a[0]=i=>t.selectedCity=i),class:"border border-[#C8C8C8] rounded p-2 my-4 w-full"},[Q,(u(!0),h(M,null,T(t.showCities,i=>(u(),h("option",{key:i.City,value:i.City},R(i.CityName),9,J))),128))],512),[[L,t.selectedCity]]),p("button",{class:"block w-full bg-[#0D706D] text-white rounded py-2 leading-none disabled:opacity-50 disabled:cursor-default",disabled:!t.selectedCity,onClick:a[1]||(a[1]=(...i)=>t.search&&t.search(...i))}," \u641C\u5C0B ",8,Y)])):N("v-if",!0)])}var et=b(U,[["render",tt],["__scopeId","data-v-62e00ac2"]]),ot=z({history:I(),routes:[{path:"/",component:et}]});const at=()=>{const e="10010991a4f6468a9fb9430c27c1c85a",a="jhdbt1WvnqsGKO32uNl8BD3lPQk",s=new Date().toGMTString(),t=new jsSHA("SHA-1","TEXT");t.setHMACKey(a,"TEXT"),t.update("x-date: "+s);const o=t.getHMAC("B64");return{Authorization:'hmac username="'+e+'", algorithm="hmac-sha1", headers="x-date", signature="'+o+'"',"X-Date":s}},_=v.create({method:"get",baseURL:"https://ptx.transportdata.tw/MOTC/v2/Bike/",headers:at()});var st=K({state:{currentPosition:{latitude:25.0657976,longitude:121.5352149}},mutations:{setCurrentPosition(e,a){e.currentPosition=a}},actions:{getCurrentPosition({commit:e}){return new Promise((a,s)=>{navigator.geolocation.getCurrentPosition(t=>{e("setCurrentPosition",t.coords),a(t.coords)},s)})},async getStationData({state:e},a){let s="";if(a)s=`Station/${a}?$top=30`;else{const{latitude:t,longitude:o}=e.currentPosition;s=`Station/NearBy?$spatialFilter=nearby(${t},${o},500)`}try{const{data:t}=await _(s);return t}catch(t){console.error(t.message)}},async getAvailableData({state:e},a){let s="";if(a)s=`Availability/${a}?$top=30`;else{const{latitude:t,longitude:o}=e.currentPosition;s=`Availability/NearBy?$spatialFilter=nearby(${t},${o},500)`}try{const{data:t}=await _(s);return t}catch(t){console.error(t.message)}},async getCities(){try{const{data:e}=await v({method:"get",url:"https://gist.motc.gov.tw/gist_api/V3/Map/Basic/City"});return e}catch(e){return console.error(e.message),[]}}}});j(G).use(ot).use(st).mount("#app");
